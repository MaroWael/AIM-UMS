<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<!--
admin.fxml - Admin panel UI
Provides tabs for managing courses, users, students, and instructors
Enhanced UI with modern design
-->

<?import java.lang.String?>
<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.ums.system.controller.AdminController"
            prefHeight="750" prefWidth="1200"
            styleClass="admin-root"
            stylesheets="@admin.css">

    <!-- Top: Header -->
    <top>
        <VBox styleClass="admin-header">
            <padding>
                <Insets top="20" right="30" bottom="20" left="30"/>
            </padding>

            <HBox alignment="CENTER_LEFT" spacing="20">
                <Label fx:id="welcomeLabel" text="ðŸŽ“ Welcome, Admin!" styleClass="admin-welcome-label"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Button text="ðŸšª Logout" onAction="#handleLogout" styleClass="admin-logout-button">
                    <font>
                        <Font name="System Bold" size="13"/>
                    </font>
                </Button>
            </HBox>

            <Label fx:id="userInfoLabel" text="Role: Admin  |  ID: -  |  Email: -" styleClass="admin-user-info">
                <VBox.margin>
                    <Insets top="8"/>
                </VBox.margin>
                <font>
                    <Font name="System" size="13"/>
                </font>
            </Label>
        </VBox>
    </top>

    <!-- Center: Tab Pane -->
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE" styleClass="admin-tab-pane">

            <!-- COURSES TAB -->
            <Tab text="ðŸ“š Courses">
                <VBox spacing="20" styleClass="content-section">

                    <!-- Title -->
                    <Label text="ðŸ“š Course Management" styleClass="section-title">
                        <font>
                            <Font name="System Bold" size="22"/>
                        </font>
                    </Label>

                    <!-- Create Course Form -->
                    <VBox spacing="15" styleClass="form-card">
                        <Label text="âž• Create New Course" styleClass="form-title">
                            <font>
                                <Font name="System Bold" size="16"/>
                            </font>
                        </Label>

                        <GridPane hgap="15" vgap="15">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                                <ColumnConstraints percentWidth="25"/>
                            </columnConstraints>

                            <TextField fx:id="courseCodeField" promptText="Course Code"
                                       styleClass="admin-text-field"
                                       GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <TextField fx:id="courseNameField" promptText="Course Name"
                                       styleClass="admin-text-field"
                                       GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            <ComboBox fx:id="courseMajorCombo" promptText="Select Major"
                                      styleClass="admin-combo-box"
                                      GridPane.columnIndex="2" GridPane.rowIndex="0" maxWidth="Infinity"/>
                            <TextField fx:id="courseLevelField" promptText="Level (1-4)"
                                       styleClass="admin-text-field"
                                       GridPane.columnIndex="3" GridPane.rowIndex="0"/>

                            <TextField fx:id="courseLectureTimeField" promptText="Lecture Time"
                                       styleClass="admin-text-field"
                                       GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                            <ComboBox fx:id="courseInstructorCombo" promptText="Select Instructor"
                                      styleClass="admin-combo-box"
                                      prefWidth="200" GridPane.columnIndex="1" GridPane.rowIndex="1" GridPane.columnSpan="2" maxWidth="Infinity"/>
                            <Button text="âœ“ Create Course" onAction="#handleCreateCourse"
                                    styleClass="primary-button"
                                    GridPane.columnIndex="3" GridPane.rowIndex="1" maxWidth="Infinity">
                                <font>
                                    <Font name="System Bold" size="13"/>
                                </font>
                            </Button>
                        </GridPane>
                    </VBox>

                    <!-- Courses Table -->
                    <VBox spacing="12" VBox.vgrow="ALWAYS" styleClass="table-card">
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <Label text="ðŸ“‹ All Courses" styleClass="table-header-title">
                                <font>
                                    <Font name="System Bold" size="16"/>
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="ðŸ”„ Refresh" onAction="#loadAllCourses" styleClass="refresh-button">
                                <font>
                                    <Font name="System Bold" size="12"/>
                                </font>
                            </Button>
                            <Button text="ðŸ—‘ï¸ Delete Selected" onAction="#handleDeleteCourse" styleClass="delete-button">
                                <font>
                                    <Font name="System Bold" size="12"/>
                                </font>
                            </Button>
                        </HBox>

                        <TableView fx:id="coursesTable" VBox.vgrow="ALWAYS" styleClass="admin-table">
                            <columns>
                                <TableColumn fx:id="courseCodeColumn" text="Code" prefWidth="80"/>
                                <TableColumn fx:id="courseNameColumn" text="Course Name" prefWidth="250"/>
                                <TableColumn fx:id="courseLevelColumn" text="Level" prefWidth="70"/>
                                <TableColumn fx:id="courseMajorColumn" text="Major" prefWidth="150"/>
                                <TableColumn fx:id="courseLectureTimeColumn" text="Lecture Time" prefWidth="180"/>
                                <TableColumn fx:id="courseInstructorColumn" text="Instructor" prefWidth="200"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>

            <!-- USERS TAB -->
            <Tab text="ðŸ‘¥ Users">
                <VBox spacing="20" styleClass="content-section">

                    <Label text="ðŸ‘¥ User Management" styleClass="section-title">
                        <font>
                            <Font name="System Bold" size="22"/>
                        </font>
                    </Label>

                    <!-- Create User Form -->
                    <VBox spacing="15" styleClass="form-card">
                        <Label text="âž• Create New User" styleClass="form-title">
                            <font>
                                <Font name="System Bold" size="16"/>
                            </font>
                        </Label>

                        <!-- User Type Selection -->
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <Label text="User Type:" styleClass="field-label-bold">
                                <font>
                                    <Font name="System Bold" size="13"/>
                                </font>
                            </Label>
                            <ComboBox fx:id="userTypeCombo" prefWidth="150" styleClass="admin-combo-box"/>
                        </HBox>

                        <!-- Common Fields -->
                        <GridPane hgap="15" vgap="15">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="33"/>
                                <ColumnConstraints percentWidth="33"/>
                                <ColumnConstraints percentWidth="34"/>
                            </columnConstraints>

                            <TextField fx:id="userNameField" promptText="Full Name"
                                       styleClass="admin-text-field"
                                       GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <TextField fx:id="userEmailField" promptText="Email"
                                       styleClass="admin-text-field"
                                       GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                            <PasswordField fx:id="userPasswordField" promptText="Password"
                                           styleClass="admin-password-field"
                                           GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                        </GridPane>

                        <!-- Dynamic Fields for Student -->
                        <GridPane fx:id="studentFieldsPane" hgap="15" vgap="15" visible="false" managed="false">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="33"/>
                                <ColumnConstraints percentWidth="33"/>
                                <ColumnConstraints percentWidth="34"/>
                            </columnConstraints>

                            <TextField fx:id="studentLevelField" promptText="Level (1-4)"
                                       styleClass="admin-text-field"
                                       GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                            <ComboBox fx:id="studentMajorCombo" promptText="Select Major"
                                      styleClass="admin-combo-box"
                                      GridPane.columnIndex="1" GridPane.rowIndex="0" maxWidth="Infinity"/>
                            <ComboBox fx:id="studentDepartmentCombo" promptText="Department"
                                      styleClass="admin-combo-box"
                                      GridPane.columnIndex="2" GridPane.rowIndex="0" maxWidth="Infinity"/>
                        </GridPane>

                        <!-- Dynamic Fields for Instructor -->
                        <HBox fx:id="instructorFieldsPane" spacing="12" visible="false" managed="false" alignment="CENTER_LEFT">
                            <Label text="Department:" styleClass="field-label-bold">
                                <font>
                                    <Font name="System Bold" size="13"/>
                                </font>
                            </Label>
                            <ComboBox fx:id="instructorDepartmentCombo" promptText="Select Department" prefWidth="250"
                                      styleClass="admin-combo-box"/>
                        </HBox>

                        <!-- Create Button -->
                        <HBox spacing="12" alignment="CENTER_RIGHT">
                            <Button text="âœ“ Create User" onAction="#handleCreateUser" styleClass="create-button">
                                <font>
                                    <Font name="System Bold" size="14"/>
                                </font>
                            </Button>
                        </HBox>
                    </VBox>

                    <!-- Users Table -->
                    <VBox spacing="12" VBox.vgrow="ALWAYS" styleClass="table-card">
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <Label text="ðŸ“‹ All Users" styleClass="table-header-title">
                                <font>
                                    <Font name="System Bold" size="16"/>
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="ðŸ”„ Refresh" onAction="#loadAllUsers" styleClass="refresh-button">
                                <font>
                                    <Font name="System Bold" size="12"/>
                                </font>
                            </Button>
                            <Button text="ðŸ—‘ï¸ Delete Selected" onAction="#handleDeleteUser" styleClass="delete-button">
                                <font>
                                    <Font name="System Bold" size="12"/>
                                </font>
                            </Button>
                        </HBox>

                        <TableView fx:id="usersTable" VBox.vgrow="ALWAYS" styleClass="admin-table">
                            <columns>
                                <TableColumn fx:id="userIdColumn" text="ID" prefWidth="60"/>
                                <TableColumn fx:id="userNameColumn" text="Name" prefWidth="300"/>
                                <TableColumn fx:id="userEmailColumn" text="Email" prefWidth="400"/>
                                <TableColumn fx:id="userRoleColumn" text="Role" prefWidth="180"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>

            <!-- STUDENTS TAB -->
            <Tab text="ðŸŽ“ Students">
                <VBox spacing="20" styleClass="content-section">

                    <Label text="ðŸŽ“ Student Management" styleClass="section-title">
                        <font>
                            <Font name="System Bold" size="22"/>
                        </font>
                    </Label>

                    <!-- Students Table -->
                    <VBox spacing="12" VBox.vgrow="ALWAYS" styleClass="table-card">
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <Label text="ðŸ“‹ All Students" styleClass="table-header-title">
                                <font>
                                    <Font name="System Bold" size="16"/>
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="ðŸ”„ Refresh" onAction="#loadAllStudents" styleClass="refresh-button">
                                <font>
                                    <Font name="System Bold" size="12"/>
                                </font>
                            </Button>
                            <Button text="ðŸ“ Update Level" onAction="#handleUpdateStudentLevel" styleClass="update-button">
                                <font>
                                    <Font name="System Bold" size="12"/>
                                </font>
                            </Button>
                        </HBox>

                        <TableView fx:id="studentsTable" VBox.vgrow="ALWAYS" styleClass="admin-table">
                            <columns>
                                <TableColumn fx:id="studentIdColumn" text="ID" prefWidth="60"/>
                                <TableColumn fx:id="studentNameColumn" text="Name" prefWidth="350"/>
                                <TableColumn fx:id="studentEmailColumn" text="Email" prefWidth="450"/>
                                <TableColumn fx:id="studentLevelColumn" text="Level" prefWidth="180"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>

            <!-- INSTRUCTORS TAB -->
            <Tab text="ðŸ‘¨â€ðŸ« Instructors">
                <VBox spacing="20" styleClass="content-section">

                    <Label text="ðŸ‘¨â€ðŸ« Instructor Management" styleClass="section-title">
                        <font>
                            <Font name="System Bold" size="22"/>
                        </font>
                    </Label>

                    <!-- Instructors Table -->
                    <VBox spacing="12" VBox.vgrow="ALWAYS" styleClass="table-card">
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <Label text="ðŸ“‹ All Instructors" styleClass="table-header-title">
                                <font>
                                    <Font name="System Bold" size="16"/>
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="ðŸ”„ Refresh" onAction="#loadAllInstructors" styleClass="refresh-button">
                                <font>
                                    <Font name="System Bold" size="12"/>
                                </font>
                            </Button>
                        </HBox>

                        <TableView fx:id="instructorsTable" VBox.vgrow="ALWAYS" styleClass="admin-table">
                            <columns>
                                <TableColumn fx:id="instructorIdColumn" text="ID" prefWidth="60"/>
                                <TableColumn fx:id="instructorNameColumn" text="Name" prefWidth="350"/>
                                <TableColumn fx:id="instructorEmailColumn" text="Email" prefWidth="450"/>
                                <TableColumn fx:id="instructorDeptColumn" text="Department" prefWidth="240"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>

            <!-- REVENUE TAB -->
            <Tab text="ðŸ’° Revenue">
                <VBox spacing="20" styleClass="content-section">

                    <Label text="ðŸ’° Revenue Management" styleClass="section-title">
                        <font>
                            <Font name="System Bold" size="22"/>
                        </font>
                    </Label>

                    <!-- Revenue Summary Cards -->
                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>

                        <!-- Total Revenue Card -->
                        <VBox spacing="8" styleClass="revenue-card-blue" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="ðŸ’µ Total Revenue" styleClass="revenue-card-label">
                                <font>
                                    <Font name="System" size="13"/>
                                </font>
                            </Label>
                            <Label fx:id="totalRevenueLabel" text="0.00 EGP" styleClass="revenue-card-value">
                                <font>
                                    <Font name="System Bold" size="24"/>
                                </font>
                            </Label>
                            <Label fx:id="totalPaymentsLabel" text="0 payments" styleClass="revenue-card-subtext">
                                <font>
                                    <Font name="System" size="11"/>
                                </font>
                            </Label>
                        </VBox>

                        <!-- Level 1 Revenue Card -->
                        <VBox spacing="8" styleClass="revenue-card-green" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="ðŸ“š Level 1 (Freshman)" styleClass="revenue-card-label">
                                <font>
                                    <Font name="System" size="13"/>
                                </font>
                            </Label>
                            <Label fx:id="level1RevenueLabel" text="0.00 EGP" styleClass="revenue-card-value">
                                <font>
                                    <Font name="System Bold" size="20"/>
                                </font>
                            </Label>
                        </VBox>

                        <!-- Level 2 Revenue Card -->
                        <VBox spacing="8" styleClass="revenue-card-orange" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="ðŸ“š Level 2 (Sophomore)" styleClass="revenue-card-label">
                                <font>
                                    <Font name="System" size="13"/>
                                </font>
                            </Label>
                            <Label fx:id="level2RevenueLabel" text="0.00 EGP" styleClass="revenue-card-value">
                                <font>
                                    <Font name="System Bold" size="20"/>
                                </font>
                            </Label>
                        </VBox>

                        <!-- Level 3 Revenue Card -->
                        <VBox spacing="8" styleClass="revenue-card-purple" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="ðŸ“š Level 3 (Junior)" styleClass="revenue-card-label">
                                <font>
                                    <Font name="System" size="13"/>
                                </font>
                            </Label>
                            <Label fx:id="level3RevenueLabel" text="0.00 EGP" styleClass="revenue-card-value">
                                <font>
                                    <Font name="System Bold" size="20"/>
                                </font>
                            </Label>
                        </VBox>

                        <!-- Level 4 Revenue Card -->
                        <VBox spacing="8" styleClass="revenue-card-red" GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <Label text="ðŸ“š Level 4 (Senior)" styleClass="revenue-card-label">
                                <font>
                                    <Font name="System" size="13"/>
                                </font>
                            </Label>
                            <Label fx:id="level4RevenueLabel" text="0.00 EGP" styleClass="revenue-card-value">
                                <font>
                                    <Font name="System Bold" size="20"/>
                                </font>
                            </Label>
                        </VBox>

                        <!-- Successful Payments Card -->
                        <VBox spacing="8" styleClass="revenue-card-teal" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <Label text="âœ… Successful" styleClass="revenue-card-label">
                                <font>
                                    <Font name="System" size="13"/>
                                </font>
                            </Label>
                            <Label fx:id="successfulPaymentsLabel" text="0" styleClass="revenue-card-value">
                                <font>
                                    <Font name="System Bold" size="20"/>
                                </font>
                            </Label>
                            <Label text="payments" styleClass="revenue-card-subtext">
                                <font>
                                    <Font name="System" size="11"/>
                                </font>
                            </Label>
                        </VBox>

                        <!-- Failed Payments Card -->
                        <VBox spacing="8" styleClass="revenue-card-pink" GridPane.columnIndex="2" GridPane.rowIndex="1">
                            <Label text="âŒ Failed" styleClass="revenue-card-label">
                                <font>
                                    <Font name="System" size="13"/>
                                </font>
                            </Label>
                            <Label fx:id="failedPaymentsLabel" text="0" styleClass="revenue-card-value">
                                <font>
                                    <Font name="System Bold" size="20"/>
                                </font>
                            </Label>
                            <Label text="payments" styleClass="revenue-card-subtext">
                                <font>
                                    <Font name="System" size="11"/>
                                </font>
                            </Label>
                        </VBox>

                        <!-- Pending Payments Card -->
                        <VBox spacing="8" styleClass="revenue-card-yellow" GridPane.columnIndex="3" GridPane.rowIndex="1">
                            <Label text="â³ Pending" styleClass="revenue-card-label">
                                <font>
                                    <Font name="System" size="13"/>
                                </font>
                            </Label>
                            <Label fx:id="pendingPaymentsLabel" text="0" styleClass="revenue-card-value">
                                <font>
                                    <Font name="System Bold" size="20"/>
                                </font>
                            </Label>
                            <Label text="payments" styleClass="revenue-card-subtext">
                                <font>
                                    <Font name="System" size="11"/>
                                </font>
                            </Label>
                        </VBox>
                    </GridPane>

                    <!-- Payments Table -->
                    <VBox spacing="12" VBox.vgrow="ALWAYS" styleClass="table-card">
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <Label text="ðŸ“‹ All Payments" styleClass="table-header-title">
                                <font>
                                    <Font name="System Bold" size="16"/>
                                </font>
                            </Label>
                            <Region HBox.hgrow="ALWAYS"/>
                            <ComboBox fx:id="paymentStatusFilterCombo" promptText="Filter by Status"
                                      styleClass="admin-combo-box" prefWidth="150"
                                      onAction="#handleFilterPayments"/>
                            <ComboBox fx:id="paymentLevelFilterCombo" promptText="Filter by Level"
                                      styleClass="admin-combo-box" prefWidth="150"
                                      onAction="#handleFilterPayments"/>
                            <Button text="ðŸ”„ Refresh" onAction="#loadAllPayments" styleClass="refresh-button">
                                <font>
                                    <Font name="System Bold" size="12"/>
                                </font>
                            </Button>
                        </HBox>

                        <TableView fx:id="paymentsTable" VBox.vgrow="ALWAYS" styleClass="admin-table">
                            <columns>
                                <TableColumn fx:id="paymentIdColumn" text="ID" prefWidth="60"/>
                                <TableColumn fx:id="paymentUserIdColumn" text="Student ID" prefWidth="100"/>
                                <TableColumn fx:id="paymentUserNameColumn" text="Student Name" prefWidth="200"/>
                                <TableColumn fx:id="paymentLevelColumn" text="Level" prefWidth="80"/>
                                <TableColumn fx:id="paymentAmountColumn" text="Amount (EGP)" prefWidth="120"/>
                                <TableColumn fx:id="paymentMethodColumn" text="Method" prefWidth="130"/>
                                <TableColumn fx:id="paymentStatusColumn" text="Status" prefWidth="100"/>
                                <TableColumn fx:id="paymentTransactionColumn" text="Transaction ID" prefWidth="180"/>
                                <TableColumn fx:id="paymentDateColumn" text="Date" prefWidth="150"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </Tab>

        </TabPane>
    </center>

</BorderPane>
